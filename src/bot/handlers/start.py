"""Handler for /start command."""

import logging

from aiogram import Router
from aiogram.filters import Command
from aiogram.fsm.context import FSMContext
from aiogram.types import Message

from src.bot.states import GenerationStates
from src.utils.analytics import register_user

logger = logging.getLogger(__name__)

router = Router()

START_MESSAGE = """ðŸ‘‹ ÐŸÑ€Ð¸Ð²ÐµÑ‚. Ð¯ â€” Ñ‚Ð²Ð¾Ñ Ñ„Ð¾Ñ‚Ð¾ÑÑ‚ÑƒÐ´Ð¸Ñ Ð² Ñ‚ÐµÐ»ÐµÑ„Ð¾Ð½Ðµ Ñ Ð¸Ð½Ñ„Ð¾Ð³Ñ€Ð°Ñ„Ð¸ÐºÐ¾Ð¹!

Ð’Ð¼ÐµÑÑ‚Ð¾ Ñ‚Ð¾Ð³Ð¾ Ñ‡Ñ‚Ð¾Ð±Ñ‹ Ð²ÐµÐ·Ñ‚Ð¸ Ñ‚Ð¾Ð²Ð°Ñ€ Ð² ÑÑ‚ÑƒÐ´Ð¸ÑŽ, Ð¾Ð±ÑŠÑÑÐ½ÑÑ‚ÑŒ Ñ„Ð¾Ñ‚Ð¾Ð³Ñ€Ð°Ñ„Ñƒ, Ð¶Ð´Ð°Ñ‚ÑŒ ÑÑŠÑ‘Ð¼ÐºÑƒ Ð¸ Ð¾Ð±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÑƒ â€” Ñ‚Ñ‹ Ð¿Ñ€Ð¾ÑÑ‚Ð¾:

â€¢ Ð¾Ñ‚Ð¿Ñ€Ð°Ð²Ð»ÑÐµÑˆÑŒ Ñ„Ð¾Ñ‚Ð¾ Ñ‚Ð¾Ð²Ð°Ñ€Ð°,
â€¢ ÑÐ»Ð¾Ð²Ð°Ð¼Ð¸ Ð¸Ð»Ð¸ Ð³Ð¾Ð»Ð¾ÑÐ¾Ð²Ñ‹Ð¼ Ð³Ð¾Ð²Ð¾Ñ€Ð¸ÑˆÑŒ, Ñ‡Ñ‚Ð¾ Ñ…Ð¾Ñ‡ÐµÑˆÑŒ Ð¿Ð¾Ð»ÑƒÑ‡Ð¸Ñ‚ÑŒ,
â€¢ Ð·Ð°Ð±Ð¸Ñ€Ð°ÐµÑˆÑŒ Ð³Ð¾Ñ‚Ð¾Ð²ÑƒÑŽ ÐºÐ°Ñ€Ñ‚Ð¸Ð½ÐºÑƒ Ñ Ð¸Ð½Ñ„Ð¾Ð³Ñ€Ð°Ñ„Ð¸ÐºÐ¾Ð¹ Ð´Ð»Ñ Ð¼Ð°Ñ€ÐºÐµÑ‚Ð¿Ð»ÐµÐ¹ÑÐ°.

ðŸ“Š ÐŸÐ¾ ÑƒÐ¼Ð¾Ð»Ñ‡Ð°Ð½Ð¸ÑŽ Ñ ÑÐ¾Ð·Ð´Ð°ÑŽ Ñ„Ð¾Ñ‚Ð¾ Ñ‚Ð¾Ð²Ð°Ñ€Ð° Ñ Ð¸Ð½Ñ„Ð¾Ð³Ñ€Ð°Ñ„Ð¸ÐºÐ¾Ð¹: Ð¿Ñ€ÐµÐ¸Ð¼ÑƒÑ‰ÐµÑÑ‚Ð²Ð° Ð¸ Ñ…Ð°Ñ€Ð°ÐºÑ‚ÐµÑ€Ð¸ÑÑ‚Ð¸ÐºÐ¸ Ñ‚Ð¾Ð²Ð°Ñ€Ð° Ð½Ð° Ñ€ÑƒÑÑÐºÐ¾Ð¼ ÑÐ·Ñ‹ÐºÐµ.

Ð¦ÐµÐ½Ð° â€” Ð½ÐµÑÐ¾Ð¿Ð¾ÑÑ‚Ð°Ð²Ð¸Ð¼Ð¾ Ð½Ð¸Ð¶Ðµ Ð¶Ð¸Ð²Ð¾Ð¹ Ñ„Ð¾Ñ‚Ð¾ÑÑ‚ÑƒÐ´Ð¸Ð¸, Ð° Ð¿Ð¾ ÑÐ²ÐµÑ‚Ñƒ Ð¸ Ð¿Ð¾Ð´Ð°Ñ‡Ðµ Ñ€ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚ Ð¼Ð¾Ð¶ÐµÑ‚ Ð±Ñ‹Ñ‚ÑŒ Ñ‚Ð°ÐºÐ¸Ð¼ Ð¶Ðµ Ð¸Ð»Ð¸ Ð»ÑƒÑ‡ÑˆÐµ.

Ð’Ð°Ð¶Ð½Ð¾: ÐºÐ°Ñ‡ÐµÑÑ‚Ð²Ð¾ Ð·Ð°Ð²Ð¸ÑÐ¸Ñ‚ Ð¾Ñ‚ Ñ‚Ð¾Ð³Ð¾, Ð½Ð°ÑÐºÐ¾Ð»ÑŒÐºÐ¾ Ð²Ð½ÑÑ‚Ð½Ð¾ Ñ‚Ñ‹ ÑÑ‚Ð°Ð²Ð¸ÑˆÑŒ Ð·Ð°Ð´Ð°Ñ‡Ñƒ. ÐÐµ Ð½ÑƒÐ¶Ð½Ð¾ Ð±Ñ‹Ñ‚ÑŒ Ð´Ð¸Ð·Ð°Ð¹Ð½ÐµÑ€Ð¾Ð¼ â€” Ð¿Ñ€Ð¾ÑÑ‚Ð¾ Ð¾Ð¿Ð¸ÑˆÐ¸ Ð¿Ð¾-Ñ‡ÐµÐ»Ð¾Ð²ÐµÑ‡ÐµÑÐºÐ¸:

â€¢ Ð´Ð»Ñ ÐºÐ°ÐºÐ¾Ð³Ð¾ Ð¼Ð°Ñ€ÐºÐµÑ‚Ð¿Ð»ÐµÐ¹ÑÐ°,
â€¢ Ñ‡Ñ‚Ð¾ Ð·Ð° Ñ‚Ð¾Ð²Ð°Ñ€,
â€¢ ÐºÐ°ÐºÐ¸Ðµ Ð¿Ñ€ÐµÐ¸Ð¼ÑƒÑ‰ÐµÑÑ‚Ð²Ð° Ð¿Ð¾ÐºÐ°Ð·Ð°Ñ‚ÑŒ (Ð¸Ð»Ð¸ Ñ ÑÐ°Ð¼ Ð¾Ð¿Ñ€ÐµÐ´ÐµÐ»ÑŽ),
â€¢ ÐµÑÐ»Ð¸ Ð½Ðµ Ð½ÑƒÐ¶Ð½Ð° Ð¸Ð½Ñ„Ð¾Ð³Ñ€Ð°Ñ„Ð¸ÐºÐ° â€” ÑÐºÐ°Ð¶Ð¸ "Ñ‚Ð¾Ð»ÑŒÐºÐ¾ Ñ„Ð¾Ñ‚Ð¾" Ð¸Ð»Ð¸ "Ð±ÐµÐ· Ð¸Ð½Ñ„Ð¾Ð³Ñ€Ð°Ñ„Ð¸ÐºÐ¸".

ÐÐ° Ð²Ñ…Ð¾Ð´Ðµ â€” 1 Ñ„Ð¾Ñ‚Ð¾ Ñ‚Ð¾Ð²Ð°Ñ€Ð° Ð¸ ÐºÐ¾Ñ€Ð¾Ñ‚ÐºÐ¾Ðµ Ð¾Ð¿Ð¸ÑÐ°Ð½Ð¸Ðµ (Ñ‚ÐµÐºÑÑ‚Ð¾Ð¼ Ð¸Ð»Ð¸ Ð³Ð¾Ð»Ð¾ÑÐ¾Ð¼).
ÐÐ° Ð²Ñ‹Ñ…Ð¾Ð´Ðµ â€” ÑƒÐ»ÑƒÑ‡ÑˆÐµÐ½Ð½Ð°Ñ Ñ„Ð¾Ñ‚Ð¾Ð³Ñ€Ð°Ñ„Ð¸Ñ Ñ‚Ð¾Ð²Ð°Ñ€Ð° Ñ Ð¸Ð½Ñ„Ð¾Ð³Ñ€Ð°Ñ„Ð¸ÐºÐ¾Ð¹, Ð³Ð¾Ñ‚Ð¾Ð²Ð°Ñ Ð´Ð»Ñ Ð¿ÑƒÐ±Ð»Ð¸ÐºÐ°Ñ†Ð¸Ð¸ Ð½Ð° Ð¼Ð°Ñ€ÐºÐµÑ‚Ð¿Ð»ÐµÐ¹ÑÐµ.

ÐÐ°Ð¿Ð¸ÑˆÐ¸ /gen (Ð¸Ð»Ð¸ Ð¿Ñ€Ð¾ÑÑ‚Ð¾ "Ð³ÐµÐ½"), Ñ‡Ñ‚Ð¾Ð±Ñ‹ ÑÐ¾Ð·Ð´Ð°Ñ‚ÑŒ Ð¿ÐµÑ€Ð²ÑƒÑŽ ÐºÐ°Ñ€Ñ‚Ð¸Ð½ÐºÑƒ."""


@router.message(Command("start"))
async def cmd_start(message: Message, state: FSMContext) -> None:
    """Handle /start command."""
    user_id = message.from_user.id if message.from_user else None
    username = message.from_user.username if message.from_user else None

    # Register user for analytics
    if user_id:
        await register_user(user_id, username)

    await state.set_state(GenerationStates.IDLE)
    await message.answer(START_MESSAGE)
    logger.info(f"User {user_id} started the bot")

